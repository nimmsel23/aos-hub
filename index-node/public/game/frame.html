<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Frame Map</title>
  <style>
    :root {
      --bg: #0a0a0a;
      --card: #111;
      --border: #333;
      --text: #e0e0e0;
      --accent: #00ff41;
      --glow: rgba(0,255,65,0.3);
      --red: #ff3333;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      line-height: 1.7;
    }

    nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
      background: #000;
      padding: 16px;
      text-align: center;
      border-bottom: 4px solid var(--accent);
      box-shadow: 0 0 30px var(--glow);
    }

    nav a {
      color: #fff;
      margin: 0 40px;
      text-decoration: none;
      font-weight: 900;
      font-size: 20px;
      letter-spacing: 2px;
    }

    nav a:hover, nav a.active {
      color: var(--accent);
      text-shadow: 0 0 15px var(--glow);
    }

    .container {
      max-width: 1100px;
      margin: 120px auto 60px;
      padding: 0 20px;
    }

    h1 {
      font-size: 52px;
      font-weight: 900;
      text-align: center;
      margin: 0 0 20px;
      background: linear-gradient(90deg, var(--accent), #00cc33);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px var(--glow);
    }

    .subtitle {
      text-align: center;
      color: #888;
      font-size: 20px;
      margin-bottom: 60px;
      font-style: italic;
    }

    .card {
      background: var(--card);
      padding: 50px;
      border-radius: 24px;
      border: 2px solid var(--border);
      box-shadow: 0 15px 50px rgba(0,255,65,0.1);
      margin-bottom: 50px;
    }

    .domain {
      background: #000;
      padding: 40px;
      border-radius: 20px;
      border-left: 8px solid var(--accent);
      margin: 40px 0;
      transition: all 0.4s;
    }

    .domain:hover {
      box-shadow: 0 0 30px var(--glow);
    }

    h2 {
      font-size: 36px;
      color: var(--accent);
      margin: 0 0 40px;
      padding-left: 10px;
    }

    label {
      display: block;
      margin: 30px 0 12px;
      font-size: 18px;
      color: #aaa;
      font-weight: 600;
    }

    textarea {
      width: 100%;
      padding: 20px;
      background: #000;
      color: #fff;
      border: 2px solid #333;
      border-radius: 16px;
      font-size: 18px;
      min-height: 160px;
      transition: all 0.4s;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 25px var(--glow);
      outline: none;
    }

    button {
      background: linear-gradient(135deg, var(--accent), #00cc33);
      color: #000;
      padding: 20px 60px;
      border: none;
      border-radius: 16px;
      font-size: 22px;
      font-weight: 900;
      cursor: pointer;
      margin: 40px auto 20px;
      display: block;
      box-shadow: 0 12px 40px rgba(0,255,65,0.4);
      text-transform: uppercase;
      letter-spacing: 2px;
      transition: all 0.4s;
    }

    button:hover {
      transform: translateY(-6px);
      box-shadow: 0 20px 50px rgba(0,255,65,0.6);
    }

    .saved {
      color: var(--accent);
      font-size: 20px;
      text-align: center;
      margin: 30px 0;
      opacity: 0;
    }

    .saved.show { animation: fade 2s; }

    @keyframes fade {
      0% { opacity: 0; transform: translateY(20px); }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; transform: translateY(-20px); }
    }

    footer { text-align: center; padding: 80px 20px 40px; color: #444; font-size: 14px; }

    .tab-nav {
      display: flex;
      gap: 20px;
      margin: 40px 0 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .tab-btn {
      background: #000;
      color: #aaa;
      border: 2px solid #333;
      padding: 16px 40px;
      font-size: 20px;
      font-weight: 900;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.4s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .tab-btn.active, .tab-btn:hover {
      background: var(--accent);
      color: #000;
      box-shadow: 0 0 30px var(--glow);
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.6s; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: none; }
    }
  </style>
</head>
<body>

<nav>
  <a href="/game/" class="active">FRAME MAP</a>
</nav>

<div class="container">
  <h1>FRAME MAP</h1>
  <div class="subtitle">Einmal im Jahr · 4 Domains · 20 Wahrheiten</div>

  <div class="tab-nav">
    <button class="tab-btn active" onclick="openTab('body', event)">BODY</button>
    <button class="tab-btn" onclick="openTab('being', event)">BEING</button>
    <button class="tab-btn" onclick="openTab('balance', event)">BALANCE</button>
    <button class="tab-btn" onclick="openTab('business', event)">BUSINESS</button>
  </div>

  <div class="card">
    <div id="body" class="tab-content active">
      <div class="domain">
        <h2>BODY</h2>
        <label>1. Where am I now?</label>
        <textarea id="body_where"></textarea>
        <label>2. How did I get here?</label>
        <textarea id="body_how"></textarea>
        <label>3. How do I feel about where I am?</label>
        <textarea id="body_feel"></textarea>
        <label>4. What is working?</label>
        <textarea id="body_working"></textarea>
        <label>5. What is not working?</label>
        <textarea id="body_not"></textarea>
        <button onclick="save('Body', false)">BODY speichern</button>
        <button onclick="save('Body', true)">BODY → TickTick</button>
      </div>
    </div>

    <div id="being" class="tab-content">
      <div class="domain">
        <h2>BEING</h2>
        <label>1. Where am I now?</label><textarea id="being_where"></textarea>
        <label>2. How did I get here?</label><textarea id="being_how"></textarea>
        <label>3. How do I feel?</label><textarea id="being_feel"></textarea>
        <label>4. What is working?</label><textarea id="being_working"></textarea>
        <label>5. What is not working?</label><textarea id="being_not"></textarea>
        <button onclick="save('Being', false)">BEING speichern</button>
        <button onclick="save('Being', true)">BEING → TickTick</button>
      </div>
    </div>

    <div id="balance" class="tab-content">
      <div class="domain">
        <h2>BALANCE</h2>
        <label>1. Where am I now?</label><textarea id="balance_where"></textarea>
        <label>2. How did I get here?</label><textarea id="balance_how"></textarea>
        <label>3. How do I feel?</label><textarea id="balance_feel"></textarea>
        <label>4. What is working?</label><textarea id="balance_working"></textarea>
        <label>5. What is not working?</label><textarea id="balance_not"></textarea>
        <button onclick="save('Balance', false)">BALANCE speichern</button>
        <button onclick="save('Balance', true)">BALANCE → TickTick</button>
      </div>
    </div>

    <div id="business" class="tab-content">
      <div class="domain">
        <h2>BUSINESS</h2>
        <label>1. Where am I now?</label><textarea id="business_where"></textarea>
        <label>2. How did I get here?</label><textarea id="business_how"></textarea>
        <label>3. How do I feel?</label><textarea id="business_feel"></textarea>
        <label>4. What is working?</label><textarea id="business_working"></textarea>
        <label>5. What is not working?</label><textarea id="business_not"></textarea>
        <button onclick="save('Business', false)">BUSINESS speichern</button>
        <button onclick="save('Business', true)">BUSINESS → TickTick</button>
      </div>
    </div>

    <div class="saved" id="saved">gespeichert</div>
  </div>
</div>

<footer>FRAME MAP – Alpha OS | 2026 beginnt hier.</footer>
<script>
function openTab(domain, evt) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  if (evt && evt.target) evt.target.classList.add('active');
  document.getElementById(domain.toLowerCase()).classList.add('active');
}

function safeId(prefix) {
  return `${prefix}-${Date.now().toString(36)}`;
}

async function postFrameEntry(domain, markdown, ticktick) {
  const title = `${domain}_frame_${new Date().toISOString().slice(0,10)}`;
  const res = await fetch('/api/game/export', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ map: 'frame', title, markdown, ticktick: !!ticktick })
  });
  const data = await res.json();
  if (!data.ok) throw new Error(data.error || 'save failed');
  return data;
}

async function save(domain, ticktick) {
  const p = domain.toLowerCase();
  const answers = {
    whereNow: document.getElementById(p + '_where').value.trim(),
    howGotHere: document.getElementById(p + '_how').value.trim(),
    howFeel: document.getElementById(p + '_feel').value.trim(),
    whatWorking: document.getElementById(p + '_working').value.trim(),
    whatNotWorking: document.getElementById(p + '_not').value.trim()
  };

  if (!answers.whereNow) return alert('Where am I now? nicht leer lassen');

  const header = [
    `# FRAME MAP – ${domain}`,
    `**Session:** ${safeId('FRM')}`,
    `**Datum:** ${new Date().toLocaleDateString('de-DE')}`,
    '',
    '---',
    ''
  ].join('\n');

  const body = [
    '**1. Where am I now?**',
    answers.whereNow || '-',
    '',
    '**2. How did I get here?**',
    answers.howGotHere || '-',
    '',
    '**3. How do I feel about where I am?**',
    answers.howFeel || '-',
    '',
    '**4. What is working?**',
    answers.whatWorking || '-',
    '',
    '**5. What is not working?**',
    answers.whatNotWorking || '-'
  ].join('\n');

  try {
    await postFrameEntry(domain, header + body, ticktick);
    ['_where','_how','_feel','_working','_not'].forEach(s => {
      const el = document.getElementById(p + s);
      if (el) el.value = '';
    });
    const saved = document.getElementById('saved');
    if (saved) {
      saved.classList.remove('show');
      void saved.offsetWidth;
      saved.classList.add('show');
    }
  } catch (err) {
    alert('Fehler beim Speichern: ' + err.message);
  }
}
</script>

</body>
</html>
