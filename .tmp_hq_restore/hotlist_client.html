<script>
  function addToHotList() {
    const input = document.getElementById('hotlist-input');
    const idea = input ? input.value.trim() : '';

    if (!idea) return;

    showToast(`Added to Hot List: "${idea}"`);
    addToTerminal(`hotlist "${idea}"`, `✓ Hot List item created: "${idea}"`);

    const counter = document.getElementById('hot-list-count');
    if (counter) {
      counter.textContent = String(parseInt(counter.textContent || '0', 10) + 1);
    }

    input.value = '';

    try {
      const user = getWebUser();
      google.script.run
        .withSuccessHandler(res => {
          loadDashboardStats();
          if (res && res.ticktick && res.ticktick.ok) {
            showToast('TickTick: Hot List synced');
            return;
          }
          if (res && res.ticktick && res.ticktick.error) {
            showToast(`TickTick: ${res.ticktick.error}`);
            return;
          }
          showToast('Hot List saved (TickTick skipped)');
        })
        .withFailureHandler(err => {
          const message = (err && err.message) ? err.message : String(err || 'Unknown error');
          if (typeof showToast === 'function') showToast(`Hot List error: ${message}`);
          if (typeof addToTerminal === 'function') addToTerminal('hotlist', `✗ Hot List save failed: ${message}`);
        })
        .hotlist_addWeb(idea, user);
    } catch (_) {}
  }

  function handleHotListEnter(event) {
    if (event.key === 'Enter') {
      addToHotList();
    }
  }

  function addToHotListTelegram() {
    const input = document.getElementById('hotlist-input');
    const idea = input ? input.value.trim() : '';
    if (!idea) return;
    const tg = window.Telegram && window.Telegram.WebApp;
    const inTelegram = Boolean(tg && (tg.initData || (tg.initDataUnsafe && tg.initDataUnsafe.user)));
    if (!inTelegram) return addToHotList();

    try {
      const data = {
        type: 'hotlist',
        idea: idea,
        timestamp: new Date().toISOString(),
        source: 'telegram_webapp'
      };
      if (typeof tg.sendData === 'function') tg.sendData(JSON.stringify(data));
      if (typeof tg.close === 'function') tg.close();
    } catch (err) {
      return addToHotList();
    }
  }
</script>
