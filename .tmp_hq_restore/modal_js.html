<script>
  function AOS_modalOpen(opts){
    opts = opts || {};
    const overlay = document.getElementById('aosModalOverlay');
    const titleEl = document.getElementById('aosModalTitle');
    const subEl   = document.getElementById('aosModalSub');
    const bodyEl  = document.getElementById('aosModalBody');
    if (!overlay || !titleEl || !bodyEl) return;

    titleEl.textContent = opts.title || 'Modal';
    subEl.textContent   = opts.sub || '';
    bodyEl.innerHTML    = opts.html || '';

    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden', 'false');

    overlay._escHandler = (e) => { if (e.key === 'Escape') AOS_modalClose(); };
    document.addEventListener('keydown', overlay._escHandler);

    overlay._clickHandler = (e) => { if (e.target === overlay) AOS_modalClose(); };
    overlay.addEventListener('click', overlay._clickHandler);
  }

  function AOS_modalClose(){
    const overlay = document.getElementById('aosModalOverlay');
    if (!overlay) return;
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden', 'true');

    if (overlay._escHandler) document.removeEventListener('keydown', overlay._escHandler);
    if (overlay._clickHandler) overlay.removeEventListener('click', overlay._clickHandler);
    overlay._escHandler = null;
    overlay._clickHandler = null;
  }
</script>
